{"version":3,"file":"game.js","sources":["node_modules/auto-reload-brunch/vendor/auto-reload.js","src/game.coffee"],"names":[],"mappings":"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","sourcesContent":["(function() {\n  var WebSocket = window.WebSocket || window.MozWebSocket;\n  var br = window.brunch = (window.brunch || {});\n  var ar = br['auto-reload'] = (br['auto-reload'] || {});\n  if (!WebSocket || ar.disabled) return;\n\n  var cacheBuster = function(url){\n    var date = Math.round(Date.now() / 1000).toString();\n    url = url.replace(/(\\&|\\\\?)cacheBuster=\\d*/, '');\n    return url + (url.indexOf('?') >= 0 ? '&' : '?') +'cacheBuster=' + date;\n  };\n\n  var browser = navigator.userAgent.toLowerCase();\n  var forceRepaint = ar.forceRepaint || browser.indexOf('chrome') > -1;\n\n  var reloaders = {\n    page: function(){\n      window.location.reload(true);\n    },\n\n    stylesheet: function(){\n      [].slice\n        .call(document.querySelectorAll('link[rel=\"stylesheet\"][href]:not([data-autoreload=\"false\"]'))\n        .forEach(function(link) {\n          link.href = cacheBuster(link.href);\n        });\n\n      // Hack to force page repaint after 25ms.\n      if (forceRepaint) setTimeout(function() { document.body.offsetHeight; }, 25);\n    }\n  };\n  var port = ar.port || 9485;\n  var host = br.server || window.location.hostname || 'localhost';\n\n  var connect = function(){\n    var connection = new WebSocket('ws://' + host + ':' + port);\n    connection.onmessage = function(event){\n      if (ar.disabled) return;\n      var message = event.data;\n      var reloader = reloaders[message] || reloaders.page;\n      reloader();\n    };\n    connection.onerror = function(){\n      if (connection.readyState) connection.close();\n    };\n    connection.onclose = function(){\n      window.setTimeout(connect, 1000);\n    };\n  };\n  connect();\n})();\n","module.exports = ->\n\n  decodeKeyStates =\n    HIDDEN: 0\n    REVEALED: 1\n    SOLVED: 2\n\n  secretMessage = undefined\n  comboGroups = undefined\n  decodeKey = undefined\n  comboStream = undefined\n  score = undefined\n  moves = undefined\n\n  isLetter = (char) ->\n    /[a-z]/i.test char\n  isLetterOrSpace = (char) ->\n    /[a-z\\s]/i.test char\n  isSpace = (char) ->\n    /[\\s]/i.test char\n\n  hideLetters = (char) ->\n    if not isLetter char\n      decodeKeyStates.SOLVED\n    else\n      decodeKeyStates.HIDDEN\n\n  decodeChar = (secretChar, decodingStatus)  ->\n    if shouldReveal decodingStatus\n      return secretChar\n    else\n      return \"_\"\n\n  # encodedMessage, decodeKey -> decodedMessage\n  decode = R.compose(R.join(''), R.zipWith(decodeChar))\n\n  sentanceToWords = (sentance) ->\n    breakIntoWords = (acc, char, index) ->\n      if isLetterOrSpace char\n        if isSpace char\n          acc.push []\n        else\n          charInfo =\n            char: char\n            index: index\n            reveal: false\n          acc[acc.length - 1].push charInfo\n      acc\n    R.reduceIndexed breakIntoWords, [[]], sentance\n\n\n  shouldReveal = (decodingStatus) ->\n    decodingStatus in [decodeKeyStates.REVEALED, decodeKeyStates.SOLVED]\n\n  comboToString = R.compose R.join(\"\"), R.map(R.prop \"char\")\n\n  setIndexIfNotSolved = (value, arr, index) ->\n    if arr[index] isnt decodeKeyStates.SOLVED\n      arr[index] = value\n    arr\n\n  setIndexes = R.curry (value, arr, indexes) ->\n    R.reduce R.partial(setIndexIfNotSolved, value), arr, indexes\n\n\n  setIndexesToSolved = setIndexes decodeKeyStates.SOLVED\n  setIndexesToRevealed = setIndexes decodeKeyStates.REVEALED\n\n  resetAllUnsolved = (decodeKey) ->\n    nullifyAllNonSolved = (i) ->\n      if i is decodeKeyStates.SOLVED then i else decodeKeyStates.HIDDEN\n    R.map nullifyAllNonSolved, decodeKey\n\n  updatedecodeKey = (comboString, decodeKey, comboGroup) ->\n    pattern = new RegExp \"^\" + comboString, \"i\"\n    comboGroupString = comboToString comboGroup\n\n    if pattern.test comboGroupString\n      indexes = R.map(R.prop \"index\") R.take comboString.length, comboGroup\n      if comboString.length is comboGroup.length\n        return setIndexesToSolved decodeKey, indexes\n      else\n        return setIndexesToRevealed decodeKey, indexes\n    else\n      return decodeKey\n\n\n  getAllMatches = (comboGroups, comboStream, decodeKey) ->\n    if comboStream.length < 1\n      return decodeKey\n    comboString = comboToString comboStream\n    decodeKey = R.reduce R.partial(updatedecodeKey, comboString), decodeKey, comboGroups\n    return getAllMatches comboGroups, comboStream.slice(1), decodeKey\n\n\n  getValidComboStream = (comboStream, comboGroups) ->\n    if comboStream.length < 1\n      # no valid combo\n      return []\n\n    comboString = comboToString comboStream\n    pattern = new RegExp \"^\" + comboString, \"i\"\n    joinAndMatch = R.compose(R.match(pattern), comboToString)\n    isValidCombo = R.any joinAndMatch, comboGroups\n\n    if isValidCombo\n      return comboStream\n    else\n      # recurse with shorter and shorter combo streams\n      getValidComboStream comboStream.slice(1), comboGroups\n\n\n  # main \"loop\"\n  onKeyDown =  ($, render, e) ->\n    e.preventDefault()\n\n    key = e.keyCode\n\n    # give up?\n    if e.keyCode is 191 # \"?\"\n      # give up; show the secret message\n     $(document).off 'keydown'\n     $(document).on 'keydown', -> initializeGame($,render)\n     $(\"#give-up\").hide()\n     render secretMessage, \"You gave up!<br>Press any key to play again.\", 0\n\n    char = String.fromCharCode(key).toLowerCase()\n    # ignore non-letter inputs\n    if isLetter char\n      # update state\n      moves++\n      score = Math.max(0, score - 1)\n      potentialCombo = R.concat comboStream, [{char:char}]\n      comboStream = getValidComboStream potentialCombo, comboGroups\n      decodeKey = resetAllUnsolved decodeKey\n      decodeKey = getAllMatches comboGroups, comboStream, decodeKey\n\n      # display\n      console.log 'comboStream:', comboToString comboStream\n      console.log 'decodeKey:', decodeKey\n      render decode(secretMessage, decodeKey), (comboToString(comboStream) or char), score\n\n      # won?\n      totalUnsolved = R.length R.filter(R.not(R.eq(decodeKeyStates.SOLVED))) decodeKey\n      if totalUnsolved is 0\n        $(document).off 'keydown'\n        $(document).on 'keydown', -> initializeGame($,render)\n        $(\"#give-up\").hide()\n        render decode(secretMessage, decodeKey), \"SOLVED in #{moves} moves!<br>Press any key to play again.\", score\n\n\n  initializeGame = ($, render) ->\n    $(document).off('keydown')\n\n    render \"\", \"LOADING...\", \"\"\n\n    $.get \"https://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20html%20where%20url%3D'http%3A%2F%2Fwww.iheartquotes.com%2Fapi%2Fv1%2Frandom%3Fmax_characters%3D75%26format%3Djson'&format=json&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys\", (response) ->\n\n      parse = (str = \"\") ->\n        str = str.trim()\n        str = str.replace(/\\t/g, \"\")\n        str\n\n      quote = JSON.parse(response.query.results.body).quote\n\n      message = quote.split(/[\\n\\r]?\\s\\s--/)[0]\n      source = quote.split(/[\\n\\r]?\\s\\s--/)[1]\n\n      # set initial game state\n      secretMessage = message\n\n      # static\n      comboGroups = sentanceToWords secretMessage\n\n      # dynamic\n      decodeKey = R.map hideLetters, secretMessage\n      comboStream = []\n      score = R.filter(isLetter, secretMessage).length * 5\n      moves = 0\n\n      # start game\n      render decode(secretMessage, decodeKey), \"Type letter combos to reveal the hidden message.\", score\n      $(\"#give-up\").show()\n      $(document).on \"keydown\", R.partial onKeyDown, $, render\n\n\n\n# kick off\n  Zepto ($) ->\n    $secretMessage = $(\"#secret-message\")\n    $feedback = $(\"#feedback\")\n    $score = $(\"#score\")\n    render = (secretMessage, feedback, score) ->\n      $secretMessage.text secretMessage\n      $feedback.html feedback\n      $score.text score\n\n    initializeGame $, render\n"]}